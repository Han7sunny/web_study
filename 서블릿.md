# 서블릿

의미있는 비즈니스 로직을 제외한 모든 작업을 수행해줌

```java
@WebServlet(name = "helloServlet", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet{
	@Override
	protected void service(HttpServletRequest request, HttpServletResponse response){
		// 애플리케이션 로직
	}
}
```

HTTP 요청을 통해 매핑된 URL이 호출되면 서블릿 컨테이너는 서블릿 코드(`service()`) 실행

- `@WebServlet` : 서블릿 어노테이션
    - name : 서블릿 이름
    - urlPatterns : URL 매핑
- HTTP 요청 정보를 편리하게 사용할 수 있는 `HttpServletRequest` by. Servlet
- HTTP 응답 정보를 편리하게 제공할 수 있는 `HttpServletResponse` by. Servlet
- 개발자는 HTTP 스펙을 매우 편리하게 사용 .. HTTP 스펙 어느정도는 알아야 함

HTTP 요청, 응답 흐름

- HTTP 요청시
    - WAS는 Request, Response 객체를 새로 만들어 서블릿 객체 호출
    - 개발자는 Request 객체에서 HTTP 요청 정보를 편리하게 꺼내서 사용
    - 개발자는 Response 객체에 HTTP 응답 정보를 편리하게 작성
    - WAS는 Response 객체에 담겨있는 내용으로 HTTP 응답 정보를 생성(웹 브라우저가 HTTP를 렌더링해서 화면 출력)
    

서블릿 컨테이너

- 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 함
- 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기 관리
- 서블릿 객체는 **Single-ton으로 관리 (객체를 하나만 생성new하고 이를 재활용)**
    - 고객의 요청이 올 때마다 계속 객체를 생성하는 것은 비효율
    - 최초 로딩 시점에서 서블릿 객체 미리 만들어두고 재활용
    - 모든 고객 요청은 동일한 서블릿 객체 인스턴스에 접근 (Single-ton)
    - **공유 변수(멤버 변수) 사용 주의**
    - 서블릿 컨테이너 종료시 함께 종료
- JSP도 서블릿으로 변환되어 사용
- **동시 요청을 위한 멀티 쓰레드 처리 지원**

**HTTP 요청 데이터**

: HTTP 요청 메시지를 통해 클라이언트에서 서버로 데이터를 전달하는 3가지 방법

1. GET 쿼리 파라미터
    - 메시지 바디 없이 URL의 쿼리 파라미터를 사용하여 데이터 전달
        
        예) 검색, 필터, 페이징 등에서 많이 사용
        

쿼리 파라미터는 URL에 다음과 같이 `?`를 시작으로 보낼 수 있으며 추가 파라미터는 `&`로 구분

```bash
http://localhost:8080/request-param?username=han&age=20
```

서버에서는 `HttpServletRequest`가 제공하는 다음 메서드를 통해 쿼리 파라미터 조회 가능

```java
package hello.servlet.basic.request;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Enumeration;

/**
 * 1. 파라미터 전송 기능
 * http://localhost:8080/request-param?username=hello&age=20
 * <p>
 * 2. 동일한 파라미터 전송 가능
 * http://localhost:8080/request-param?username=hello&username=han&age=20
 */

@WebServlet(name = "requestParamServlet", urlPatterns = "/request-param")
public class RequestParamServlet extends HttpServlet {
	@Override
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// 전체 파라미터 조회
		request.getParameterNames().asIterator()
		 .forEachRemaining(paramName -> System.out.println(paramName + "=" + request.getParameter(paramName)));
	 
	
	 // 단일 파라미터 조회
	 String username = request.getParameter("username");
	 System.out.println("request.getParameter(username) = " + username);
	 String age = request.getParameter("age");
	 System.out.println("request.getParameter(age) = " + age);

	 // 이름이 같은 복수 파라미터 조회
	 String[] usernames = request.getParameterValues("username");
	 for (String name : usernames)
			System.out.println("username=" + name);
	 
	 response.getWriter().write("ok"); // web browser에 출력
 }
}
```

- `request.getParameter()`는 하나의 파라미터 이름에 대해 단 하나의 값만 있을 때 사용
- 복수 파라미터를 조회할 때 `request.getParameter()` 사용하면 `request.getParameterValues()`의 첫번째 값 반환

1. POST HTML Form
    - content-type : application/x-www-form-urlencoded
    - 메시지 바디에 쿼리 파라미터 형식으로 데이터 전달
        
        예) 회원 가입, 상품 주문, HTML Form 사용
        

간단한 테스트는 HTML Form 직접 생성하지 않고 [Postman](https://www.postman.com/) 사용

1. POST
2. [http://localhost:8080/request-param](http://localhost:8080/request-param)
3. Body → x-www-form-urlencoded 선택
4. Headers에서 Content-Type : application/x-www-form-urlencoded로 지정되었는지 확인
5. Send

HTML의 Form을 사용하여 클라이언트에서 서버로 데이터 전송

1. HTTP message body에 데이터 직접 담아서 요청
