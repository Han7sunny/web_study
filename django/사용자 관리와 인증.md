# 사용자 관리와 인증
1. modles.py
  + 기본 사용자 모델 : username(id)와 password 속성만 관리
    User 모델 확장 방법 (주로 1,2 사용)
    1. AbstractUser : 기본 사용자 모델을 상속 받아 새로운 필드들을 추가
    2. AbstractBaseUser : 기본 사용자 모델을 사용하지 않고 새로운 User 모델 정의 (필드, 기능 모두 새로 정의)
    3. OneToOne 모델 : 기본 User 모델과 1:1로 연결되는 자식 Model(테이블)을 생성하여 새 필드들을 추가
    4. Proxy 모델 : User 모델의 스키마는 그대로 사용하고 기능을 변경/추가
          
  + 확장 User 모델 
    + models.py에 User Model 클래스 확장
      ```python
      # app명/models.py
      from django.db import models
      from django.contrib.auth.models import AbstractUser
      
      # AbstractUser 확장(상속) : 기존 User모델(username(id), password) + 추가 Field
      class CustomUser(AbstractUser):
        GENDER_CHOICE = [
          ['M', '남성'], # <option value='M'>남성</option>
          ['F', '여성']  # index 0: 전송될 값, index 1: 입력양식에 보여질 값
        ]

        name = models.CharField(verbose_name='이름', max_length=100)
        email = models.EmailField(verbose_name='이메일', max_length=100)
        gender = models.CharField(verbose_name='성별', max_length=1, choices=GENDER_CHOICE)

        def __str__(self):
            return f"{self.pk}. {self.name}"
      ```
    + settings.py에 User 모델 등록 
      ```python
      # settings.py
       
      # CustomUser 모델 등록 
      AUTH_USER_MODEL = "app이름.User모델클래스이름" # 문자열로 등록
      ```
    + admin.py에 UserAdmin 구현
      + 관리자 앱에서 사용자정보를 관리하기 위하여 등록
      ```python
      from django.contrib import admin
      from django.contrib.auth.admin import UserAdmin
      from .models import CustomUser


      # UserAdmin : 관리자앱에서 사용자 관리 화면 => customizing
      class CustomUserAdmin(UserAdmin): # default : UserAdmin
        # 기본정보 카테고리 설정
        UserAdmin.fieldsets[1][1]['fields'] = ('name', 'email', 'gender')

        list_display = ['username', 'name', 'email'] # 목록 화면


      admin.site.register(CustomUser, CustomUserAdmin) # admin.site.register(User모델,UserAdmin)
      ```
    
2. forms.py
  + User Model과 연동된 ModelForm
  + 가입form : django.contrib.auth.forms.UserCreationForm
    + username, password1, password2 입력 받아 username과 password 등록
  + 수정form : django.contrib.auth.forms.UserChangeForm
    ```python
    from django.contrib.auth.forms import UserCreationForm
    from django.contrib.auth import get_user_model # settings.py 에 등록된 AUTH_USER_MODEL 클래스를 반환.
    from django import forms

    class CustomUserCreationForm(UserCreationForm):
      
      password1 = forms.CharField(label='Password', widget=forms.PasswordInput()) # <input type='password'> # default type = 'text'
      password2 = forms.CharField(label='Password 확인', widget=forms.PasswordInput())

      class Meta: 
          # model = User Model 클래스
          model = get_user_model() # settings.py의 AUTH_USER_MODEL = 'app이름.User모델클래스이름' 객체 호출됨
          fields = ["username", "password1",'password2'  ,"name", "email", "gender"]
          # fields = '__all__'
          # model의 Field들의 widget(입력양식)을 변경하고자 할때 widgets 속성에 딕셔너리에 등록한다. (field명:widget객체)
          # widgets = {
          #     "name":forms.Textarea
          # }
    ```
3. urls.py
```python
from django.urls import path
from . import forms

urlpatterns = [
    # path('join', views.UserCreateView.as_view(), name='join'),
    path('join', CreateView.as_view(template_name='template 파일 경로', 
                                    form_class=forms.CustomUserCreationForm,
                                    success_url='/'), name='join'),
    ]
```
